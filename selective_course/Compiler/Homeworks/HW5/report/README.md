# hw5 report

|||
|-:|:-|
|Name|陳星宇|
|ID|109550060|

## How much time did you spend on this project

> e.g. 15 hours.

## Project overview

- We apply visitor pattern in this assignment and treat the `CodeGenerator` as a visitor.
- First, we need to modify the variable node in Semantic Analyzer so that when a variable is scanned, it's offset in the stack (sp+offset) is recorded in the symbol entry.
- Second, we have to write program and function prologue (as they save the information on stacks) and define global variable/constant and functions in the sections.
- Then, inside every node, we usually visit every child of it first, as the children will save information to the stack so that the parent node can retrieve it from the stack. However, there are some special cases that we have to dump some instructions first then visit the children. For example, condition and loop nodes require the label `Lx:` first then generate the body. Another special case is the `VariableReferenceNode`. If it is placed at the lhs of the `AssignmentNode`, we have to push the memory location(reference) to the stack, while we have to push the value in other situations. I've done this by rejecting to visit the `VariableReferenceNode` inside the `AssignmentNode`. Instead, I dump the instructions directly inside the `AssignmentNode`.

## What is the hardest you think in this project

- It took me a lot of time to view the code template, although there are comments already, I still got confused about where should I start with. Also, there are some OOP skills or declarations that I've never used before (like local function, const_cast, etc.). Sometimes I was stuck figuring out the reason of compiling error, and it turns out that I've missed the `const` or `&` when using getter function of the class.
- Another point is that, even though we can compare our `risc-v` instructions with same code generated by `C` compiler, there are still a bunch of differences between them. So it took me a lot of time to get my first 10 points qq. I had done some searches about the testcase about exhaust of argument register - to push it on the stack. However, I don't know how to retrive it from the stack of the caller and maintain `s0` and `sp` correctly.

## Feedback to T.A.s

I hope that there could be some `TODO` labels to guide me where to start my code. For example, before I realize how the stack pointer and frame pointer works, I didn't realize that we need to modify the `SemanticAnalyzer` to modify the symbol table (originally I thought I can modify it from the `CodeGenerator` and found it is readonly becuz of `const` declaration). However, I still learned a lot from OOP designs and got more familiar with the stack. Thanks for your tutorial and devotion to each assignment!